"use strict";(globalThis.webpackChunkkris_kerr_senior_technical_writer=globalThis.webpackChunkkris_kerr_senior_technical_writer||[]).push([[7566],{1248(e,s,n){n.r(s),n.d(s,{assets:()=>o,contentTitle:()=>c,default:()=>a,frontMatter:()=>l,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"deploying-aml-on-kubernetes","title":"Deploying AML on Kubernetes","description":"Instructions for deploying AML on Kubernetes","source":"@site/docs/deploying-aml-on-kubernetes.md","sourceDirName":".","slug":"/deploying-aml-on-kubernetes","permalink":"/kris.kerr.professional.website/docs/deploying-aml-on-kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deploying-aml-on-kubernetes.md","tags":[],"version":"current","frontMatter":{"title":"Deploying AML on Kubernetes","description":"Instructions for deploying AML on Kubernetes","keywords":["installation","install","deploy","deploying","kubernetes"]},"sidebar":"tutorialSidebar","previous":{"title":"Delete a widget","permalink":"/kris.kerr.professional.website/docs/deleting-a-widget"},"next":{"title":"Deploying rgOne on a single Linux VM","permalink":"/kris.kerr.professional.website/docs/deploying-rgone-on-single-linux-vm"}}');var i=n(4848),t=n(8453);const l={title:"Deploying AML on Kubernetes",description:"Instructions for deploying AML on Kubernetes",keywords:["installation","install","deploy","deploying","kubernetes"]},c=void 0,o={},d=[{value:"Overview",id:"overview",level:2},{value:"Minimum system requirements",id:"minimum-system-requirements",level:2},{value:"Installation prerequisites",id:"installation-prerequisites",level:2},{value:"General",id:"general",level:3},{value:"Software tools",id:"software-tools",level:3},{value:"Secrets",id:"secrets",level:2},{value:"Namespace",id:"namespace",level:2},{value:"Deployments",id:"deployments",level:2},{value:"Services",id:"services",level:2},{value:"Ingress",id:"ingress",level:2},{value:"To deploy AML on Kubernetes",id:"to-deploy-aml-on-kubernetes",level:2},{value:"Ingress controller",id:"ingress-controller",level:2},{value:"Support",id:"support",level:2}];function h(e){const s={a:"a",br:"br",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["AML is made up of 14 microservices that are packaged as Docker container images:\r\n",(0,i.jsx)(s.img,{alt:"AML microservices diagram",src:n(3049).A+"",title:"AML microservices diagram",width:"1300",height:"860"})]}),"\n",(0,i.jsxs)(s.p,{children:["These container images are archived to Redpoint Global's private docker repository at ",(0,i.jsx)(s.a,{href:"https://cloud.docker.com/u/redpointglobal/repository/list",children:"https://cloud.docker.com/u/redpointglobal/repository/list"}),"."]}),"\n",(0,i.jsx)(s.h2,{id:"minimum-system-requirements",children:"Minimum system requirements"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)("font",{color:"red",children:"@@Rob, are there any minimum system requirements?@@"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"installation-prerequisites",children:"Installation prerequisites"}),"\n",(0,i.jsx)(s.h3,{id:"general",children:"General"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"A running Kubernetes cluster to which you can connect."}),"\n",(0,i.jsxs)(s.li,{children:["A\xa0user\xa0account with:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Permissions\xa0to\xa0operate\xa0on\xa0the\xa0Kubernetes\xa0cluster."}),"\n",(0,i.jsx)(s.li,{children:"Full\xa0access\xa0to\xa0the\xa0AML\xa0namespace\xa0in\xa0which\xa0AML\xa0will\xa0be\xa0deployed."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["A\xa0Docker\xa0Hub\xa0account.\r\nIn\xa0order\xa0to\xa0pull\xa0the\xa0AML\xa0container\xa0images\xa0from\xa0the\xa0Redpoint\xa0AML\xa0repository\xa0in\xa0Docker\xa0Hub:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Create\xa0an\xa0account\xa0for\xa0your\xa0company\xa0on\xa0Docker\xa0Hub."}),"\n",(0,i.jsx)(s.li,{children:"Give\xa0the\xa0account\xa0username\xa0to\xa0Redpoint\xa0support\xa0so\xa0they\xa0can grant\xa0you\xa0the\xa0permissions\xa0needed\xa0to\xa0pull\xa0the\xa0images\xa0from\xa0the\xa0Redpoint\xa0AML\xa0repository."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["A\xa0",(0,i.jsx)(s.code,{children:".zip"})," file\xa0containing\xa0the\xa0YAML\xa0definition\xa0files\xa0for\xa0the\xa0AML\xa0application (these\xa0will\xa0be\xa0provided\xa0by\xa0Redpoint\xa0Support)."]}),"\n",(0,i.jsx)(s.li,{children:"A\xa0MongoDB\xa0database\xa0or\xa0CosmosDB\xa0account\xa0to\xa0which\xa0some\xa0of\xa0the\xa0AML\xa0microservices\xa0will\xa0connect (for\xa0state\xa0persistence\xa0and\xa0data\xa0storage)."}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"software-tools",children:"Software tools"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Git","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Using\xa0BASH,\xa0not\xa0PowerShell\xa0or\xa0Windows\xa0Command\xa0Prompt."}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://git-scm.com/download",children:"https://git-scm.com/download"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"kubectl"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"This version\xa0must\xa0be\xa0compatible\xa0with\xa0the\xa0Kubernetes\xa0cluster\xa0version."}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl/",children:"https://kubernetes.io/docs/tasks/tools/install-kubectl/"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"secrets",children:"Secrets"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"https://kubernetes.io/docs/concepts/configuration/secret/"})}),"\n",(0,i.jsx)(s.li,{children:"AML must\xa0connect\xa0to\xa0an\xa0external\xa0MongoDB\xa0or CosmosDB\xa0instance\xa0(recommended\xa0for\xa0production)."}),"\n",(0,i.jsx)(s.li,{children:"AML\xa0container\xa0images\xa0are\xa0hosted\xa0in\xa0a\xa0private\xa0Docker\xa0repository."}),"\n",(0,i.jsx)(s.li,{children:"For these reasons, we will create Kubernetes secrets to store the MongoDB connection string and the Docker Hub login credentials in a secure manner."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"The following table lists environment variables that should be stored as secrets and the container that needs the variables:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Environment variables that should be stored as secrets"}),(0,i.jsx)(s.th,{children:"Container that needs these variables"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dbapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dcc-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dcc-init"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"MONGODB_NAME"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dbapi"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"ADL2_ACCESS_KEY"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dbapi"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"S3_ACCESS_KEY"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dbapi"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"S3_SECRET_ACCESS_KEY"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dbapi"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"GCS_CREDENTIAL"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RPDM_PASS"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"ml-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"ml-scheduler"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"KEYCLOAK_ADMIN_PASS"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"dcc-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dcc-init"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"RPI_SHARED_PASS"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsxs)(s.td,{children:[(0,i.jsx)(s.code,{children:"dcc-servicesapi"}),(0,i.jsx)("br",{}),(0,i.jsx)(s.code,{children:"dcc-init"})]}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"SMTP_PASS"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"dcc-init"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"DEFAULT_DCC_ADMIN_PASS"})})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"namespace",children:"Namespace"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/",children:"https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/"})}),"\n",(0,i.jsx)(s.li,{children:"It's\xa0good\xa0practice\xa0to\xa0deploy\xa0AML\xa0in\xa0its\xa0own\xa0namespace."}),"\n",(0,i.jsxs)(s.li,{children:["The namespace\xa0",(0,i.jsx)(s.code,{children:"aml"}),"\xa0will\xa0be\xa0created\xa0for\xa0this\xa0purpose."]}),"\n",(0,i.jsx)(s.li,{children:"All\xa0AML\xa0components\xa0related\xa0to\xa0this\xa0installation\xa0will\xa0be\xa0deployed\xa0in\xa0this\xa0namespace."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"deployments",children:"Deployments"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/",children:"https://kubernetes.io/docs/concepts/workloads/controllers/deployment/"})}),"\n",(0,i.jsx)(s.li,{children:"AML\xa0includes\xa014\xa0deployment\xa0definitions (one\xa0for\xa0each\xa0microservice)."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"services",children:"Services"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/services-networking/service/",children:"https://kubernetes.io/docs/concepts/services-networking/service/"})}),"\n",(0,i.jsx)(s.li,{children:"AML includes 14 service definitions (one for each microservice)."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"ingress",children:"Ingress"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/services-networking/ingress/",children:"https://kubernetes.io/docs/concepts/services-networking/ingress/"})}),"\n",(0,i.jsx)(s.li,{children:"AML\xa0includes\xa0five\xa0ingress\xa0resource\xa0definitions (one\xa0ingress resource for\xa0each\xa0endpoint\xa0we\xa0need\xa0to\xa0expose\xa0outside\xa0the\xa0cluster)."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"to-deploy-aml-on-kubernetes",children:"To deploy AML on Kubernetes"}),"\n",(0,i.jsxs)(s.ol,{children:["\n",(0,i.jsx)(s.li,{children:"Connect to your Kubernetes cluster."}),"\n",(0,i.jsxs)(s.li,{children:["Download the AML Kubernetes YAML definitions from the Redpoint CDN.\r\n",(0,i.jsx)(s.a,{href:"https://rpgcdnfiles.blob.core.windows.net/aml/kubernetes_manifests/kubernetes_manifests.zip",children:"https://rpgcdnfiles.blob.core.windows.net/aml/kubernetes_manifests/kubernetes_manifests.zip"})]}),"\n",(0,i.jsxs)(s.li,{children:["Extract the downloaded ",(0,i.jsx)(s.code,{children:".zip"})," file and navigate to the ",(0,i.jsx)(s.code,{children:"Mercury"})," directory.",(0,i.jsx)(s.br,{}),"\n",(0,i.jsx)(s.strong,{children:"Note:"})," Make sure you are in the ",(0,i.jsx)(s.code,{children:"\\kubernetes_manifests\\Mercury"})," directory before executing the following ",(0,i.jsx)(s.code,{children:"kubectl"})," commands."]}),"\n",(0,i.jsxs)(s.li,{children:["Create a namespace for AML.","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl\xa0apply\xa0-f\xa0./namespace/namespace.yaml\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Edit the ",(0,i.jsx)(s.code,{children:"aml-deploy-secrets.sh"})," file located in the ",(0,i.jsx)(s.code,{children:"secrets"})," folder and replace the placeholder values with your own values. Once that is done, create the secrets.","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl\xa0apply\xa0-f\xa0./secrets/aml-deploy-secrets.sh\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Create the AML services.","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl\xa0apply\xa0-f\xa0./services/\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Create the AML deployments.","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl\xa0apply\xa0-f\xa0./deployments/\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Create the Ingress resources.","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl\xa0apply\xa0-f\xa0./ingress/\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Verify that all pods are executing.","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl\xa0get\xa0all\xa0--namespace\xa0aml\n"})}),"\n"]}),"\n",(0,i.jsx)(s.li,{children:"Troubleshoot any errors and/or problems by checking the container logs and resolve them accordingly."}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"ingress-controller",children:"Ingress controller"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"At\xa0this\xa0point, AML is fully installed and executing in the Kubernetes\xa0cluster."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"In order for the Ingress resources we created to work, the cluster must have an executing Ingress controller."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"The Ingress controller receives incoming traffic and routes to the appropriate service using the rules we defined in the Ingress resources we created."}),"\n",(0,i.jsx)(s.li,{children:"This will expose the external endpoints required for the end users to access the UI and Admin pages."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["There\xa0are\xa0many\xa0implementations\xa0of\xa0the\xa0Kubernetes Ingress\xa0controller\xa0that\xa0you\xa0can\xa0read\xa0about\xa0",(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/",children:"here"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"The\xa0URL\xa0endpoints\xa0are composed\xa0of\xa0the\xa0load\xa0balancer\xa0IP\xa0+\xa0the\xa0path\xa0to\xa0the\xa0service:"}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Kubernetes Ingress Controller Service"}),(0,i.jsx)(s.th,{children:"URL"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"UI\xa0Login"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"http://EXTERNAL-IP/#/Login"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Admin\xa0Page"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"http://EXTERNAL-IP/Admin/"})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Swagger\xa0docs"}),(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"http://EXTERNAL-IP/docs/"})})]})]})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"TLS\xa0configuration\xa0is\xa0beyond the\xa0scope\xa0of\xa0this\xa0installation\xa0guide."}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"support",children:"Support"}),"\n",(0,i.jsxs)(s.p,{children:["If you encounter any application-specific (non-Kubernetes) errors that you are unable to resolve, ",(0,i.jsx)(s.a,{href:"getting-help",children:"contact us"})," with the details."]})]})}function a(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},3049(e,s,n){n.d(s,{A:()=>r});const r=n.p+"assets/images/aml-microservices-diagram-486b7a8832400a0ed12790ef9d7311e7.png"},8453(e,s,n){n.d(s,{R:()=>l,x:()=>c});var r=n(6540);const i={},t=r.createContext(i);function l(e){const s=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:s},e.children)}}}]);